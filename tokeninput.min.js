!function(t,e){"use strict";"object"==typeof exports&&void 0!==module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.TokenInput=e()}(this,function(){"use strict";var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},s=/[&<>"'\/]/g;function U(t){return(e=t,String(null==e?"":e)).replace(s,function(t){return n[t]});var e}var o={method:"GET",queryParam:"q",searchDelay:300,minChars:1,doSearchOnFocus:!1,propertyToSearch:"name",jsonContainer:null,contentType:"json",excludeCurrent:!1,excludeCurrentParameter:"x",prePopulate:null,processPrePopulate:!1,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&#215;",animateDropdown:!0,placeholder:null,theme:null,zindex:999,resultsLimit:null,enableHTML:!1,resultsFormatter:function(t){var e=t[this.propertyToSearch];return"<li>"+(this.enableHTML?e:U(e))},tokenFormatter:function(t){var e=t[this.propertyToSearch];return"<li><p>"+(this.enableHTML?e:U(e))+"</p>"},tokenLimit:null,tokenDelimiter:",",preventDuplicates:!1,tokenValue:"id",allowFreeTagging:!1,allowTabOut:!1,autoSelectFirstResult:!1,onResult:null,onCachedResult:null,onAdd:null,onFreeTaggingAdd:null,onDelete:null,onReady:null,idPrefix:"token-input-",disabled:!1},z={tokenList:"token-input-list",token:"token-input-token",tokenReadOnly:"token-input-token-readonly",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token",focused:"token-input-focused",disabled:"token-input-disabled"},$={BEFORE:0,AFTER:1,END:2},K={BACKSPACE:8,DELETE:46,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:188};var i=function(d,t,g){function i(t){t.focus()}function l(t){return d.tokenInputsettings.enableHTML?t:U(t)}function f(){var t=d.tokenInputsettings;return"function"==typeof t.url?t.url.call(t):t.url}if("string"==typeof t||"function"==typeof t){d.tokenInputsettings.url=t;var e=f();void 0===d.tokenInputsettings.crossDomain&&"string"==typeof e&&(-1===e.indexOf("://")?d.tokenInputsettings.crossDomain=!1:d.tokenInputsettings.crossDomain=window.location.href.split(/\/+/g)[1]!==e.split(/\/+/g)[1])}else"object"==typeof t&&(d.tokenInputsettings.local_data=t);if(d.tokenInputsettings.classes){var n={};Object.keys(z).forEach(function(t){n[t]=z[t]}),Object.keys(d.tokenInputsettings.classes).forEach(function(t){n[t]=d.tokenInputsettings.classes[t]}),d.tokenInputsettings.classes=n}else d.tokenInputsettings.theme?(d.tokenInputsettings.classes={},Object.keys(z).forEach(function(t){d.tokenInputsettings.classes[t]=z[t]+"-"+d.tokenInputsettings.theme})):d.tokenInputsettings.classes=z;var s,o,a=[],r=0,k=new function(e){var n,s={max_size:500},o={},i=0;e=e||{},Object.keys(e).forEach(function(t){s[t]=e[t]}),n=function(){o={},i=0},this.add=function(t,e){i>s.max_size&&n(),o[t]||(i+=1),o[t]=e},this.get=function(t){return o[t]}},h=d,u=null;function c(t){null!==t&&t.classList.remove(d.tokenInputsettings.classes.selectedDropdownItem),u=null}var p=new RegExp("[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]","g");function I(t){return t.replace(p,"\\$&")}function m(t,e,n){return t.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+I(e)+")(?![^<>]*>)(?![^&;]+;)","g"),(s=n,e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+I(s)+")(?![^<>]*>)(?![^&;]+;)","gi"),function(t,e){var n=l(e);return n&&t&&(n="<strong>"+n+"</strong>"),n})));var s}var v=document.createElement("ul");v.classList.add(d.tokenInputsettings.classes.tokenList),h.parentNode.insertBefore(v,h);var y=d.tokenInputsettings.idPrefix+d.id,E=document.createElement("input");E.setAttribute("autocomplete","off"),E.style.outline="none",E.id=y;var T=document.createElement("li");T.classList.add(d.tokenInputsettings.classes.inputToken),T.appendChild(E),v.appendChild(T);var b=document.createElement("div");function L(){b.style.position="absolute",b.style.top=v.getBoundingClientRect().top+document.body.scrollTop+v.offsetHeight+parseInt(window.getComputedStyle(v).marginTop.replace(/px$/,""),10)+parseInt(window.getComputedStyle(v).marginBottom.replace(/px$/,""),10)+"px",b.style.left=v.getBoundingClientRect().left+document.body.scrollLeft+"px",b.style.width=v.offsetWidth+"px",b.style.zIndex=d.tokenInputsettings.zindex,b.style.display=""}function w(t,e){var n=t.map(function(t){return"function"==typeof d.tokenInputsettings.tokenValue?d.tokenInputsettings.tokenValue.call(this,t):t[d.tokenInputsettings.tokenValue]});e.value=n.join(d.tokenInputsettings.tokenDelimiter)}b.classList.add(d.tokenInputsettings.classes.dropdown),document.body.appendChild(b),b.style.display="none";var S=null;function C(){b.style.display="none",b.innerHTML="",u=null}function x(t){d.tokenInputsettings.disabled||(t.classList.add(d.tokenInputsettings.classes.selectedToken),S=t,E.value="",C())}var O=0;function R(e){var t=e.tokeninput,n=d.tokenInputsettings.onDelete,s=!0,o=(s=[].filter.call(e.parentNode.children,function(t){return t===e&&(s=!1),s})).length;O<o&&(o-=1),e.parentNode.removeChild(e),S=null,i(E),0===(a=a.slice(0,o).concat(a.slice(o+1))).length&&E.setAttribute("placeholder",g.placeholder),o<O&&(O-=1),w(a,h),r-=1,null!==d.tokenInputsettings.tokenLimit&&(E.style.display="",E.value="",i(E)),"function"==typeof n&&n.call(h,t)}function D(t){var e,n,s,o=(e=d.tokenInputsettings.tokenFormatter(t),n="ul",(s=document.createElement(n||"div")).innerHTML=e.trim(),s.firstChild),i=!0===t.readonly;if(i&&o.classList.add(d.tokenInputsettings.classes.tokenReadOnly),o.classList.add(d.tokenInputsettings.classes.token),T.parentNode.insertBefore(o,T),!i){var l=document.createElement("a");l.href="#",l.innerHTML=d.tokenInputsettings.deleteText,l.classList.add(d.tokenInputsettings.classes.tokenDelete),o.appendChild(l),l.addEventListener("focus",function(){d.tokenInputsettings.disabled||x(this.parentNode)}),l.addEventListener("click",function(t){d.tokenInputsettings.disabled||(R(this.parentNode),h.dispatchEvent(new Event("change"))),t.preventDefault(),t.stopPropagation()}),l.addEventListener("keyup",function(t){t.keyCode!==K.BACKSPACE&&t.keyCode!==K.DELETE||(R(this.parentNode),h.dispatchEvent(new Event("change"))),t.preventDefault(),t.stopPropagation()})}var u=t;return o.tokeninput=t,a=a.slice(0,O).concat([u]).concat(a.slice(O)),O+=1,w(a,h),r+=1,null!==d.tokenInputsettings.tokenLimit&&r>=d.tokenInputsettings.tokenLimit&&(E.style.display="none",C()),o}function N(){null!==d.tokenInputsettings.tokenLimit&&r>=d.tokenInputsettings.tokenLimit&&(E.style.display="none",C())}function A(n){var t=d.tokenInputsettings.onAdd;if(0<r&&d.tokenInputsettings.preventDuplicates){var s=null;if([].forEach.call(v.children,function(t){var e=t.tokeninput;if(e&&e[g.tokenValue]===n[g.tokenValue])return s=t,!1}),s)return x(s),s.parentNode.insertBefore(T,s.nextElementSibling),void i(E)}E.style.width="1px",(null===d.tokenInputsettings.tokenLimit||r<d.tokenInputsettings.tokenLimit)&&(D(n),E.removeAttribute("placeholder"),N()),E.value="",C(),"function"==typeof t&&t.call(h,n)}function j(t){var e;if(t){u&&c(u),t.classList.add(d.tokenInputsettings.classes.selectedDropdownItem),e=t.parentNode;var n=[].slice.call(t.parentNode.children).indexOf(t);t.offsetHeight*n>=e.scrollTop+e.offsetHeight&&(e.scrollTop=t.offsetHeight*(n+1)-e.offsetHeight),t.offsetHeight*n<=e.scrollTop&&(e.scrollTop=t.offsetHeight*n),u=t}}function F(s,t){if((t=function(t){if(d.tokenInputsettings.excludeCurrent){var s=d.tokenInputObject.getTokens(),o=[];s.length&&(t.forEach(function(e){var n=!0;s.forEach(function(t){if(e[d.tokenInputsettings.propertyToSearch]===t[d.tokenInputsettings.propertyToSearch])return n=!1}),n&&o.push(e)}),t=o)}return t}(t))&&t.length){b.innerHTML="",c(u);var o=document.createElement("ul");b.appendChild(o),o.addEventListener("mouseover",function(t){for(var e=t.target,n=[];e.matches&&e.matches("li")&&n.push(e),e=e.parentNode;);j(n[0])}),o.addEventListener("mousedown",function(t){for(var e=t.target,n=[];e.matches&&e.matches("li")&&n.push(e),e=e.parentNode;);return A(n[0].tokeninput),h.dispatchEvent(new Event("change")),!1}),o.style.display="none",d.tokenInputsettings.resultsLimit&&t.length>d.tokenInputsettings.resultsLimit&&(t=t.slice(0,d.tokenInputsettings.resultsLimit)),t.forEach(function(t,e){var n=d.tokenInputsettings.resultsFormatter(t);n=m(n,t[d.tokenInputsettings.propertyToSearch],s),o.insertAdjacentHTML("beforeEnd",n),n=o.lastChild,e%2==1?n.classList.add(d.tokenInputsettings.classes.dropdownItem):n.classList.add(d.tokenInputsettings.classes.dropdownItem2),0===e&&d.tokenInputsettings.autoSelectFirstResult&&j(n),n.tokeninput=t}),L(),d.tokenInputsettings.animateDropdown?o.classList.add("fast_animate"):o.style.display=""}else d.tokenInputsettings.noResultsText&&(b.innerHTML="<p>"+l(d.tokenInputsettings.noResultsText)+"</p>",L())}function P(t,e){t.classList.remove(d.tokenInputsettings.classes.selectedToken),S=null,e===$.BEFORE?(t.parentNode.insertBefore(T,t),O-=1):e===$.AFTER?(t.parentNode.insertBefore(T,t.nextElementSibling),O+=1):(v.appendChild(T),O=r),i(E)}function H(){var t=E.value;S&&P(S,$.AFTER),t.length>=d.tokenInputsettings.minChars?(d.tokenInputsettings.searchingText&&(b.innerHTML="<p>"+l(d.tokenInputsettings.searchingText)+"</p>",L()),window.clearTimeout(s),s=window.setTimeout(function(){!function(e){var n=e+f(),t=k.get(n);if(t)"function"==typeof d.tokenInputsettings.onCachedResult&&(t=d.tokenInputsettings.onCachedResult.call(h,t)),F(e,t);else if(d.tokenInputsettings.url){var s=f(),o={data:{}};if(-1<s.indexOf("?")){var i=s.split("?");o.url=i[0],i[1].split("&").forEach(function(t){var e=t.split("=");o.data[e[0]]=e[1]})}else o.url=s;if(o.data[d.tokenInputsettings.queryParam]=e,o.type=d.tokenInputsettings.method,o.dataType=d.tokenInputsettings.contentType,d.tokenInputsettings.crossDomain&&(o.dataType="jsonp"),d.tokenInputsettings.excludeCurrent){var l=d.tokenInputObject.getTokens().map(function(t){return"function"==typeof d.tokenInputsettings.tokenValue?d.tokenInputsettings.tokenValue.call(this,t):t[d.tokenInputsettings.tokenValue]});o.data[d.tokenInputsettings.excludeCurrentParameter]=l.join(d.tokenInputsettings.tokenDelimiter)}o.success=function(){var t=JSON.parse(this.responseText);k.add(n,d.tokenInputsettings.jsonContainer?t[d.tokenInputsettings.jsonContainer]:t),"function"==typeof d.tokenInputsettings.onResult&&(t=d.tokenInputsettings.onResult.call(h,t)),E.value===e&&F(e,d.tokenInputsettings.jsonContainer?t[d.tokenInputsettings.jsonContainer]:t)},g.onSend&&g.onSend(o);var u=new XMLHttpRequest,a=o.type||"GET",r=[],c=o.data||null;Object.keys(c).forEach(function(t){r.push(encodeURIComponent(t)+"="+encodeURIComponent(c[t]))}),r=r.join("&"),u.open(a,o.url+("GET"===a&&r?"?"+r:""),!0),u.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),u.send("POST"===a&&r?r:null),u.addEventListener("load",o.success)}else if(d.tokenInputsettings.local_data){var p=d.tokenInputsettings.local_data.filter(function(t){return-1<t[d.tokenInputsettings.propertyToSearch].toLowerCase().indexOf(e.toLowerCase())});k.add(n,p),"function"==typeof d.tokenInputsettings.onResult&&(p=d.tokenInputsettings.onResult.call(h,p)),F(e,p)}}(t)},d.tokenInputsettings.searchDelay)):C()}function M(){E.value.trim().split(d.tokenInputsettings.tokenDelimiter).forEach(function(t){if(t){"function"==typeof d.tokenInputsettings.onFreeTaggingAdd&&(t=d.tokenInputsettings.onFreeTaggingAdd.call(h,t));var e={};e[d.tokenInputsettings.propertyToSearch]=t,e[d.tokenInputsettings.tokenValue]=t,A(e)}})}var B=document.createElement("tester");E.parentNode.insertBefore(B,E.nextElementSibling),B.style.position="absolute",B.style.top="-9999px",B.style.left="-9999px",B.style.width="auto";var q=window.getComputedStyle(E);function W(){if(o!==E.value){o=E.value;var t=v.offsetWidth-E.offsetLeft;B.innerHTML=U(o)||U(g.placeholder),E.style.width=Math.min(v.offsetWidth,Math.max(t,B.offsetWidth+30))-16+"px"}}function V(t){d.tokenInputsettings.disabled="boolean"==typeof t?t:!d.tokenInputsettings.disabled,E.disabled=d.tokenInputsettings.disabled,v.classList.toggle(d.tokenInputsettings.classes.disabled,d.tokenInputsettings.disabled),S&&P(S,$.END),h.disabled=d.tokenInputsettings.disabled}B.style.fontSize=q.fontSize,B.style.fontFamily=q.fontFamily,B.style.fontWeight=q.fontWeight,B.style.letterSpacing=q.letterSpacing,B.style.whiteSpace="nowrap",E.addEventListener("focus",function(){if(d.tokenInputsettings.disabled)return!1;null!==d.tokenInputsettings.tokenLimit&&d.tokenInputsettings.tokenLimit===r||(this.value||!d.tokenInputsettings.doSearchOnFocus?d.tokenInputsettings.hintText&&(b.innerHTML="<p>"+l(d.tokenInputsettings.hintText)+"</p>",L()):H()),v.classList.add(d.tokenInputsettings.classes.focused)}),E.addEventListener("blur",function(){C(),d.tokenInputsettings.allowFreeTagging&&M(),this.value="",v.classList.remove(d.tokenInputsettings.classes.focused)}),E.addEventListener("keyup",W),E.addEventListener("blur",W),E.addEventListener("update",W),E.addEventListener("keydown",function(t){var e,n;W();var s,o=null;switch(t.keyCode){case K.LEFT:case K.RIGHT:0===this.value.length?(e=T.previousElementSibling,n=T.nextElementSibling,e&&e===S||n&&n===S?t.keyCode===K.LEFT?P(S,$.BEFORE):P(S,$.AFTER):t.keyCode===K.LEFT&&e?x(e):t.keyCode===K.RIGHT&&n&&x(n)):(t.keyCode===K.DOWN||t.keyCode===K.RIGHT?(o=b.querySelector("li:first-child"),u&&(o=u.nextElementSibling)):(o=b.querySelector("li:last-child"),u&&(o=u.previousElementSibling)),j(o));break;case K.DOWN:case K.UP:t.keyCode===K.DOWN?(o=b.querySelector("li:first-child"),u&&(o=u.nextElementSibling)):(o=b.querySelector("li:last-child"),u&&(o=u.previousElementSibling)),0===b.querySelectorAll(":scope>ul").length&&window.setTimeout(function(){H()},5),j(o);break;case K.BACKSPACE:if(e=T.previousElementSibling,0===this.value.length)return S?(R(S),h.dispatchEvent(new Event("change"))):e&&x(e),!1;1===this.value.length?C():window.setTimeout(function(){H()},5);break;case K.TAB:case K.ENTER:case K.NUMPAD_ENTER:case K.COMMA:if(u)A(u.tokeninput),h.dispatchEvent(new Event("change"));else{if(d.tokenInputsettings.allowFreeTagging){if(d.tokenInputsettings.allowTabOut&&""===this.value)return!0;M()}else if(this.value="",d.tokenInputsettings.allowTabOut)return!0;t.stopPropagation(),t.preventDefault()}return!1;case K.ESCAPE:return C(),!0;default:s=[19,18,17,16,92,93,45,46,33,34,35,36,112,113,114,115,116,117,118,119,120,121,122,123,145,111,106,109,107],0<String.fromCharCode(t.which).length&&-1===s.indexOf(t.which)&&window.setTimeout(function(){H()},5)}});var _=document.querySelector("label[for='"+d.id+"'");_&&_.setAttribute("for",y),g.placeholder&&E.setAttribute("placeholder",g.placeholder),d.style.display="none",d.value="",d.addEventListener("focus",function(){i(E)}),d.addEventListener("blur",function(){return E.blur(),h}),v.addEventListener("click",function(t){for(var e,n,s=[],o=t.target;o.matches&&o.matches("li")&&s.push(o),o=o.parentNode;);(s=0<s.length?s[0]:null)&&s.tokeninput?(e=s,(n=S)&&P(S,$.END),n===e?P(e,$.END):x(e)):(S&&P(S,$.END),i(E))}),v.addEventListener("mouseover",function(t){for(var e=[],n=t.target;n.matches&&n.matches("li")&&e.push(n),n=n.parentNode;);(e=0<e.length?e[0]:null)&&S!==this&&e.classList.add(d.tokenInputsettings.classes.highlightedToken)}),v.addEventListener("mouseout",function(t){for(var e=[],n=t.target;n.matches&&n.matches("li")&&e.push(n),n=n.parentNode;);(e=0<e.length?e[0]:null)&&S!==this&&e.classList.remove(d.tokenInputsettings.classes.highlightedToken)}),h.value="";var G=d.tokenInputsettings.prePopulate||h.getAttribute("data-pre")||"[]";G=JSON.parse(G),d.tokenInputsettings.processPrePopulate&&"function"==typeof d.tokenInputsettings.onResult&&(G=d.tokenInputsettings.onResult.call(h,G)),G&&G.length&&G.forEach(function(t){D(t),N(),E.removeAttribute("placeholder")}),d.tokenInputsettings.disabled&&V(!0),"function"==typeof d.tokenInputsettings.onReady&&d.tokenInputsettings.onReady.call(),this.clear=function(){[].forEach.call(v.querySelectorAll(":scope>li"),function(t){0===t.querySelectorAll(":scope>input").length&&R(t)})},this.add=function(t){A(t)},this.remove=function(s){[].forEach.call(v.querySelectorAll(":scope>li"),function(t){if(0===t.querySelectorAll(":scope>input").length){var e=t.tokeninput,n=!0;Object.keys(s).forEach(function(t){if(s[t]!==e[t])return n=!1}),n&&R(t)}})},this.getTokens=function(){return a},this.toggleDisabled=function(t){V(t)},W()};return function(s,t,e){var n={};e=e||{},Object.keys(o).forEach(function(t){n[t]=o[t]}),Object.keys(e).forEach(function(t){n[t]=e[t]}),s.tokenInputsettings=n,s.tokenInputObject=new i(s,t,n),this.clear=function(){return s.tokenInputObject.clear(),this},this.add=function(t){return s.tokenInputObject.add(t),this},this.remove=function(t){return s.tokenInputObject.remove(t),this},this.get=function(){return s.tokenInputObject.getTokens()},this.toggleDisabled=function(t){return s.tokenInputObject.toggleDisabled(t),this},this.setOptions=function(e){var n={};return e=e||{},Object.keys(s.tokenInputsettings).forEach(function(t){n[t]=s.tokenInputsettings[t]}),Object.keys(e).forEach(function(t){n[t]=e[t]}),s.tokenInputsettings=n,this},this.destroy=function(){if(s.tokenInputObject)return s.tokenInputObject.clear(),s.previousElementSibling&&"UL"===s.previousElementSibling.tagName&&-1<s.previousElementSibling.className.indexOf("token-input")&&s.parentNode.removeChild(s.previousElementSibling),s.style.display="",s}}});